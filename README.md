# snowflakes

雪花算法
1.SnowFlake 算法，是 Twitter 开源的分布式 id 生成算法。其核心思想就是：使用一个 64 bit 的 long 型的数字作为全局唯一 id。在分布式系统中的应用十分广泛，且ID 引入了时间戳，是保持递增的。

2.组成：		
（1）第一个部分，是 1 个 bit：0，这个是无意义的。
（2）第二个部分是 41 个 bit：表示的是时间戳。
（3）第三个部分是 5 个 bit：表示的是机房 id，10001。
（4）第四个部分是 5 个 bit：表示的是机器 id，1 1001。
（5）第五个部分是 12 个 bit：表示的序号，就是某个机房某台机器上这一毫秒内同时生成的 id 的序号，0000 00000000。从0开始递增，下一毫秒又归零。

3.时间回拨问题解决：
（1）服务正在运行，由于服务器时钟校准导致的时钟回拨。
（2）服务重启，或在另一个服务器上启动时，时间不一致导致的时钟回拨。
（3）时间回调，服务器时间不准确。

解决思路：用时间基准代替每次都获取当前时间戳，时间基准在初始化时用当前时间戳赋值。（已经自己写过一个优化的雪花算法id生成器）
对于（1），时钟校准回拨的时间很短，通常在1s以内，雪花算法在内存中记录了上次的生成id时的时间戳，沉睡一下等当前时间超过上次的时间戳再继续生成ID。
对于（2），生成ID时可加上几bit的random值，让时间戳相同时加上random后相同的概率降低。
对于（3），由于服务器时间有问题，应该立即解决服务器的时间问题再生成id。